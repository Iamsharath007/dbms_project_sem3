<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>

<div id="bar-chart" style="width: 100%; height: 100%;"></div>

<script>
    $(document).ready(function() {
        // Fetch data from the Flask API endpoints
        $.ajax({
            url: 'http://127.0.0.1:5000/get_state_data_MExt',
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                // Create the bar chart with the fetched data
                createBarChart(data);
            },
            error: function(error) {
                console.log('Error fetching data:', error);
            }
        });
    });

    function createBarChart(data) {
        // Map data values to colors using a gradient scale
        var colorValues = data.values.map(function(value) {
            // Normalize the value to a range between 0 and 1
            var normalizedValue = (value - Math.min(...data.values)) / (Math.max(...data.values) - Math.min(...data.values));
            // Map the normalized value to a gradient color scale
            var color = interpolateColor('#008000', '#FF0000', normalizedValue);
            return color;
        });

        // Layout options
        var layout = {
            title: 'Extreme Men',
            autosize: true, 
            barmode: 'group' // Display bars in groups for multiple traces
        };

        // Create the bar chart
        Plotly.newPlot('bar-chart', [{
            x: data.labels,
            y: data.values,
            type: 'bar',
            marker: {
                color: colorValues  // Set the color for each bar based on the gradient scale
            }
        }], layout);

        // Add a hover event to display tooltips
        var barChart = document.getElementById('bar-chart');
        barChart.on('plotly_hover', function(data){
            var point = data.points[0];
            var hoverInfo = `<b>${point.x}</b>: ${point.y}`;
            Plotly.relayout('bar-chart', {'hoverinfo': hoverInfo});
        });
    }

    // Function to interpolate color based on a gradient between two hex colors
    function interpolateColor(color1, color2, factor) {
        var interpolate = function (color1, color2, factor) {
            return Math.round(color1 + factor * (color2 - color1));
        };

        var r1 = parseInt(color1.slice(1, 3), 16);
        var g1 = parseInt(color1.slice(3, 5), 16);
        var b1 = parseInt(color1.slice(5, 7), 16);

        var r2 = parseInt(color2.slice(1, 3), 16);
        var g2 = parseInt(color2.slice(3, 5), 16);
        var b2 = parseInt(color2.slice(5, 7), 16);

        var resultColor = {
            r: interpolate(r1, r2, factor),
            g: interpolate(g1, g2, factor),
            b: interpolate(b1, b2, factor)
        };

        return `rgb(${resultColor.r}, ${resultColor.g}, ${resultColor.b})`;
    }
</script>

</body>
</html>
